# Y86-64 CPU 模拟器 Web 应用

## 产品语言

中文

## 要构建什么

一个现代化的 Y86-64 CPU 模拟器 Web 应用，将传统的命令行模拟器升级为具有赛博朋克视觉风格的交互式界面。用户可以在浏览器中编写、加载和执行 Y86-64 汇编代码，实时观察寄存器、内存和条件码的变化过程。应用将复杂的底层计算机体系结构概念通过动画和可视化呈现，让学习过程更直观、更有吸引力。核心价值在于将枯燥的指令执行过程转化为视觉化的探索体验。

## 目标用户

计算机体系结构课程的学生，特别是正在学习流水线、汇编语言和底层架构的本科生。他们需要一个工具来验证对 Y86 指令集的理解，通过可视化观察每条指令如何改变机器状态。次要用户包括教师（用于课堂演示）和系统编程爱好者（用于自学实验）。这些用户通常具备基础编程知识，但可能对汇编和底层硬件较陌生，需要清晰的反馈和实时状态展示来建立心智模型。

## 设计氛围与感觉

融合赛博朋克与黑客终端的双重视觉风格。整体以深色为基调，黑色到深灰的渐变背景营造科幻实验室氛围。主要强调色为霓虹青色（#00ffff）和电光紫色（#9d00ff），辅以经典终端绿色（#00ff00）用于日志和代码输出区域，创造矩阵数据流的视觉联想。动画设计追求机械感和未来感——寄存器值变化时有数字滚动动画，内存写入时有闪烁高亮，按钮悬停时有霓虹发光扩散效果。界面元素带有微妙的扫描线纹理和发光边缘，让用户感觉像在操作高科技黑客工作站。字体选择 JetBrains Mono 或 Fira Code 确保代码的技术感和可读性。

## 功能与页面

单页应用（SPA）包含以下核心模块：

**代码编辑区**：左侧占据约40%宽度，集成 Monaco Editor，支持 Y86 汇编语法高亮，使用深色主题（类似 VS Code 的 Monokai 或 Dracula）。编辑器下方有控制台按钮组：加载（Load）、运行（Run）、单步执行（Step）、暂停（Pause）、重置（Reset），按钮设计为扁平风格带有霓虹边框和悬浮发光效果。

**状态面板区**：右侧占据约60%宽度，垂直分为三部分：

- 顶部：寄存器仪表盘，15个寄存器以卡片形式排列（3行5列），每个卡片显示寄存器名称和十六进制值，值变化时有高亮动画
- 中部：条件码显示（ZF/SF/OF），使用指示灯样式，亮起时发光
- 底部：内存十六进制视图，类似数据流界面，支持滚动查看和地址跳转

**输出终端**：底部横向占据全宽，黑色背景的终端窗口，显示模拟器日志和执行信息，使用等宽字体和绿色文本模拟传统终端。

首个版本包含完整的模拟器功能：代码编辑器、基础执行控制（运行/单步/暂停/重置）、寄存器实时查看、条件码状态、内存十六进制视图。后续版本将添加断点调试、性能分析和WASM优化。核心模拟逻辑先用TypeScript实现，确保快速迭代，后续可考虑移植到WebAssembly获得更高性能。

## 已实现功能

**断点调试系统**：完整的断点调试功能，支持点击行号设置/删除断点，条件断点（支持表达式如 rax==10），断点命中计数统计，启用/禁用断点开关。程序执行到断点时自动暂停，方便用户检查CPU状态。

**执行历史回溯**：时间旅行调试功能，记录每步执行的完整CPU状态快照，用户可以跳转到任意历史时刻查看状态。支持快照对比（高亮显示寄存器和条件码差异），并可导出执行轨迹为JSON文件供进一步分析。

**AI智能助手**：集成DeepSeek AI模型的智能问答系统，用户可以询问项目相关的任何问题（代码作用、架构分析、功能说明等）。支持包含当前代码上下文的问答，AI助手能够理解项目结构并提供准确的技术解答。采用赛博朋克风格的对话界面，支持多轮对话和历史记录管理。

## 界面优化

**语言统一**：全面审查并统一了所有UI组件的语言，将中英文混杂的界面文本全部调整为纯中文，包括控制中心、寄存器组、条件码、内存视图、断点调试、执行历史、输出终端等所有模块。确保用户体验的一致性和专业性。

**三列布局版本（已废弃）**：优化整体页面布局，增加所有面板之间的间距（从p-4/gap-4增加到p-6/gap-6），让每个模块有更多呼吸空间。调整三列布局比例为 38% / 37% / 25%，使各区域更加均衡。提高断点面板和输出终端的高度设置，减少内容拥挤感。

**四列布局重构（当前版本）**：基于用户反馈，将界面重构为四列独立布局，解决了内存视图与终端重叠的问题，同时优化了AI助手的呈现方式。新布局分配如下：

- **第一列（30%）**：代码编辑器 + 断点面板（h-40） + 控制面板
- **第二列（30%）**：寄存器组 + 条件码 + 内存视图
- **第三列（20%）**：执行历史面板（独立完整显示）
- **第四列（20%）**：AI助手侧边栏（类似VSCode Copilot体验）
- **底部区域**：输出终端固定在底部（h-48），上方区域高度为calc(100%-12rem)，确保所有模块互不遮挡

简化了代码编辑器头部，将混乱的"Y86-64 ASSEMBLY 11 lines | 0 breakpoints"状态栏改为清晰的"汇编代码编辑器"标题。AI助手现在作为独立侧边栏完整显示，用户可以更方便地进行代码问答和技术咨询。全面改善赛博朋克风格界面的视觉呈现，符合"高科技黑客终端"的设计理念。

**可滚动大布局（最新版本）**：基于用户反馈，移除了页面的固定高度限制，启用垂直滚动功能，让用户可以自由查看所有内容。新布局调整如下：

- 移除主容器的 `h-[calc(100vh-64px)]` 和 `overflow-hidden` 限制
- 代码编辑器增加到 **600px** 固定高度，可完整显示更多代码
- 断点面板增加到 **h-52**，显示更多断点信息
- 内存视图移到单独的中间行，最小高度 **400px**，方便详细查看内存内容
- 终端输出区域最小高度 **300px**，显示更多日志信息
- 执行历史面板和AI助手侧边栏占据完整高度，内部可滚动
- 整体布局比例优化为：30% (代码) / 25% (寄存器+条件码) / 22.5% (历史) / 22.5% (AI助手)
- 所有面板内部都支持独立滚动查看详细内容

**示例代码升级**：将简单的加法示例升级为更复杂的斐波那契数列计算程序（计算第7项），包含循环、条件判断、寄存器操作等完整指令，更好地展示Y86-64的功能。

**问题修复**：

1. 修复了Terminal组件的React ref警告问题，将ScrollArea替换为原生div，保留内部scrollRef实现自动滚动到底部的功能
2. 优化AI助手空状态提示区域，增大图标尺寸（w-12→w-20）和文字大小（text-sm→text-base, text-xs→text-sm），增加间距（mb-2→mb-4, mt-1→mt-2），提升视觉层次和可读性

## VSCode 风格 IDE 布局重构（最新版本）

基于用户反馈，将整个模拟器改造为类似 VSCode 的专业 IDE 布局，提供固定视口、可调整大小的面板，以及更专业的工作流体验。

**核心改造**：

- **固定视口**：整个应用占据 100vh，无页面滚动，所有滚动在面板内部进行
- **可调整面板**：使用 `react-resizable-panels` 实现 VSCode 级别的面板拖拽调整功能
- **专业布局**：左侧文件管理器 + 中间编辑器 + 右侧调试面板 + 极右侧辅助工具

**新增组件**：

1. **FileExplorer 文件资源管理器**：
  - 树形文件结构，支持文件夹展开/折叠
  - 预置示例程序（fibonacci.ys、sum.ys、loop.ys）
  - 点击文件自动加载到编辑器
  - 新建文件和上传功能（开发中）
  - Cyberpunk 风格图标和悬浮效果
2. **StatusBar 状态栏**：
  - 固定在底部，VSCode 标志性蓝色背景（#007acc）
  - 实时显示 CPU 状态（AOK/HLT/ADR/INS）
  - 显示当前周期数和 PC 值
  - 显示当前打开的文件名
3. **CPUDashboard CPU 仪表盘**：
  - 标签页设计：寄存器 / 条件码 / 内存
  - 整合原有的 RegisterPanel、ConditionCodes、MemoryView
  - 内部可滚动查看详细数据
  - 保持 Cyberpunk 风格的青色/紫色主题

**布局架构**（5 个可调整大小的面板）：

- **左侧栏（15%）**：文件资源管理器，可折叠，最小 10%，最大 25%
- **中间编辑区（45%）**：
  - 上部（70%）：代码编辑器
  - 断点面板（固定 128px）：显示所有断点
  - 控制面板（固定高度）：加载/运行/单步/暂停/重置按钮
  - 下部（30%）：虚拟终端，可折叠，最小 15%，最大 50%
- **右侧仪表盘（25%）**：CPU 状态（寄存器/条件码/内存），最小 20%，最大 35%
- **极右侧辅助栏（15%）**：
  - 上部（60%）：执行历史回溯面板
  - 下部（40%）：AI 代码助手
  - 可折叠，最小 12%，最大 25%

**交互优化**：

- 所有面板边界有 1px 分隔线，悬浮时变为青色提示可拖拽
- 支持面板折叠（collapsible），节省空间
- 键盘快捷键保留：F5 运行、F10 单步、F6 暂停、Ctrl+R 重置
- 文件选择自动加载程序并重置 CPU 状态

**视觉风格**：

- 保持 Cyberpunk 主题：深色背景（#1e1e1e）、面板背景（#252526）
- 青色（#00f0ff）和紫色（#bd00ff）作为强调色
- 扁平设计，去除过度装饰，专注可读性和专业感
- 状态栏使用 VSCode 标志性蓝色增强专业感

